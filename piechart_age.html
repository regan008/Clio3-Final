<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.arc path {
  stroke: #fff;
}

</style>
<body>
  <p id="year" class="menuchoice">Select
  <select>
    <option value="1910">1910</option>
    <option value="1920">1920</option>
  </select></p>
    <p id="ward" class="menuchoice">Select
  <select>
    <option value="1">Ward #1</option>
    <option value="2">Ward #2</option>
    <option value="3">Ward #3</option>
    <option value="4">Ward #4</option>
    <option value="5">Ward #5</option>
    <option value="6">Ward #6</option>
    <option value="7">Ward #7</option>
    <option value="8">Ward #8</option>
    <option value="9">Ward #9</option>
    <option value="10">Ward #10</option>
    <option value="11">Ward #11</option>
    <option value="12">Ward #12</option>
    <option value="13">Ward #13</option>
    <option value="14">Ward #14</option>
    <option value="15">Ward #15</option>
    <option value="16">Ward #16</option>
    <option value="17">Ward #17</option>
    <option value="18">Ward #18</option>
    <option value="19">Ward #19</option>
    <option value="20">Ward #20</option>
    <option value="21">Ward #21</option>
    <option value="22">Ward #22</option>
    <option value="23">Ward #23</option>
    <option value="24">Ward #24</option>
    <option value="25">Ward #25</option>
    <option value="26">Ward #26</option>
  </select></p>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>
function filterYear(d) {return +d.year === +currentYear && +d.ward === +currentWard}
var menuyear = d3.select("#year select")
    .on("change", change);  
var menuward = d3.select("#ward select")
    .on("change", change);    
var currentYear = 1910;
var currentWard = 1;

var width = 960,
    height = 500,
    radius = Math.min(width, height) / 2;

var color = d3.scale.ordinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);

var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(0);
var data;
var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.count; });
var svg = d3.select("#ages").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

d3.csv("ages.csv", function(error, csv) {
 data = csv;
 svg.selectAll("g").remove();
  data.forEach(function(d) {
    d.count = +d.count;  });
  redraw();
});


function change() {

  currentYear = menuyear.property("value")
  currentWard = menuward.property("value")
  d3.transition()
    .duration(750)
    .each(redraw);
}


function redraw() {

  svg.selectAll("g").remove();
  svg.selectAll(".arc").remove()

  var g = svg.selectAll(".arc")
      .data(pie(data.filter(filterYear)))
    .enter().append("g")
      .attr("class", "arc");

  g.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return color(d.data.agegrp); });

  g.append("text")
      .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
      .attr("dy", ".35em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.data.agegrp; });

};

</script>